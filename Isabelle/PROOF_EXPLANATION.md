# –ü—Ä–æ—Å—Ç–æ–µ —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ —Å–∏—Å—Ç–µ–º—ã —Å–∫–∏–¥–æ–∫

## üéØ –¶–µ–ª—å –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞

–î–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ **–Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç** –ø–∞—Ä—ã (—Ü–µ–Ω–∞, –∫—É–ø–æ–Ω), –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫—É–ø–æ–Ω–∞ **—É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç** —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞.

## üìã –ú–æ–¥–µ–ª—å —Å–∏—Å—Ç–µ–º—ã

### –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
```isabelle
datatype coupon_type = Absolute | Percentage

record coupon =
  ctype :: coupon_type    (* —Ç–∏–ø –∫—É–ø–æ–Ω–∞ *)
  amount :: nat           (* —Ä–∞–∑–º–µ—Ä —Å–∫–∏–¥–∫–∏ *)
```

### –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–∫–∏–¥–∫–∏
```isabelle
fun apply_discount :: "nat ‚áí coupon ‚áí nat" where
  "apply_discount price c = 
    (if ctype c = Absolute then
      (if amount c ‚â§ price then price - amount c else 0)
    else (* Percentage *)
      price - (price * amount c) div 100)"
```

## üîç –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞

### –®–∞–≥ 1: –õ–µ–º–º–∞ –¥–ª—è –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö —Å–∫–∏–¥–æ–∫
```isabelle
lemma absolute_discount_safe:
  assumes "ctype c = Absolute"
  shows "apply_discount price c ‚â§ price"
```

**–õ–æ–≥–∏–∫–∞:**
- –ï—Å–ª–∏ `amount c ‚â§ price` ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç = `price - amount c ‚â§ price` ‚úì
- –ï—Å–ª–∏ `amount c > price` ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç = `0 ‚â§ price` ‚úì

### –®–∞–≥ 2: –õ–µ–º–º–∞ –¥–ª—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã—Ö —Å–∫–∏–¥–æ–∫
```isabelle
lemma percentage_discount_safe:
  assumes "ctype c = Percentage" and "amount c ‚â§ 100"
  shows "apply_discount price c ‚â§ price"
```

**–õ–æ–≥–∏–∫–∞:**
- `apply_discount price c = price - (price * amount c) div 100`
- –ü–æ—Å–∫–æ–ª—å–∫—É `amount c ‚â§ 100` ‚Üí `(price * amount c) div 100 ‚â§ price`
- –°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ: `price - (price * amount c) div 100 ‚â§ price` ‚úì

### –®–∞–≥ 3: –û–±—â–∞—è —Ç–µ–æ—Ä–µ–º–∞
```isabelle
theorem discount_never_increases:
  assumes "valid_coupon c"
  shows "apply_discount price c ‚â§ price"
proof (cases "ctype c")
  case Absolute ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–µ–º–º—É 1
  case Percentage ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–µ–º–º—É 2
qed
```

### –®–∞–≥ 4: –¢–µ–æ—Ä–µ–º–∞ –æ –Ω–µ—Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–∏
```isabelle
theorem no_price_increase:
  "¬¨(‚àÉprice c. valid_coupon c ‚àß apply_discount price c > price)"
```

**–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –æ—Ç –ø—Ä–æ—Ç–∏–≤–Ω–æ–≥–æ:**
1. **–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º:** —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ø–∞—Ä–∞ (price, c) –≥–¥–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±–æ–ª—å—à–µ —Ü–µ–Ω—ã
2. **–ù–æ:** –∏–∑ —Ç–µ–æ—Ä–µ–º—ã –∑–Ω–∞–µ–º `apply_discount price c ‚â§ price`
3. **–ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–µ:** –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ `> price` –∏ `‚â§ price`
4. **–í—ã–≤–æ–¥:** —Ç–∞–∫–æ–π –ø–∞—Ä—ã –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç! üéâ

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏

### üöÄ **–ü—Ä–æ—Å—Ç–æ—Ç–∞:**
- –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ `nat` (–Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–µ —á–∏—Å–ª–∞)
- –ù–∏–∫–∞–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º —Å —Ç–∏–ø–∞–º–∏
- Records –≤–º–µ—Å—Ç–æ —Å–ª–æ–∂–Ω—ã—Ö datatypes

### üéØ **–Ø—Å–Ω–æ—Å—Ç—å:**
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å–ª—É—á–∞–∏
- –ü–æ–Ω—è—Ç–Ω—ã–µ –ª–µ–º–º—ã
- –ü—Ä–æ—Å—Ç—ã–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞

### üîß **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
- –í—Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è (`by simp`, `by auto`)
- –ú–∏–Ω–∏–º—É–º —Ä—É—á–Ω—ã—Ö —Ç–∞–∫—Ç–∏–∫
- –ú–∞–∫—Å–∏–º—É–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏ Isabelle

## üß™ –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

```isabelle
value "apply_discount 1000 ‚ü®ctype = Absolute, amount = 100‚ü©"    (* = 900 *)
value "apply_discount 1000 ‚ü®ctype = Percentage, amount = 20‚ü©"   (* = 800 *)
value "apply_discount 50 ‚ü®ctype = Absolute, amount = 100‚ü©"      (* = 0 *)
```

## üèÜ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–∫–∞–∑–∞–Ω–æ:** –°–∏—Å—Ç–µ–º–∞ —Å–∫–∏–¥–æ–∫ **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç** —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –ª—é–±—ã—Ö –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö!

–≠—Ç–æ –¥–∞–µ—Ç **100% –≥–∞—Ä–∞–Ω—Ç–∏—é** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–∫–∏–¥–æ–∫. üéØ 